
# Комп'ютерні системи імітаційного моделювання
## Додаткове завдання. Імітаційна модель їдальні університету у середовищі NetLogo

# СПм-24-3 Череповський Марк Андрійович 
<br>


## Завдання

Потік активних агентів ("студентів"), що обробляється по черзі. Прийняття замовлення у студента займає кілька тактів модельного часу, після чого агент-студент переміщається випадковим чином по полю в пошуках вільного місця (ділянка поля, що є "стільцем" біля ділянки-"стола"). Кожен агент, який посів місце, якийсь час його використовує, після чого зникає.
Модель повинна дозволити зрозуміти, як довго студенти стоять у черзі та скільки студентів за деякий час встигнуть поїсти.


## Мета роботи
За допомогою середовища ымытацыйного програмування розробити систему, що імітує процеси поведінки студентів у їдальні та визначає час очікуваня студентів. Симуляція повинна показати вузькі міста які змушують студентів чекати, та спробувати оптимізувати їх.

## Хід роботи 

Перш ніж переходити до написання коду, необхідно детально розробити технічне завдання, визначити основні метрики та акторів у системі.

### 1\. Опис середовища 

Як було зазначено у завданні, потрібно розробити систему їдальні. Середовище моделі складається з кількох основних типів патчів (ділянок):

  * **Зона каси (буфет):** місце, де студенти обирають та отримують товари. Для спрощення моделювання будемо вважати, що студенти отримують товар одразу після завершення часу обслуговування.
  * **Зона залу:** простір між столами, по якому студенти пересуваються після отримання товару в пошуках вільного місця.
  * **Стіни/Перешкоди:** (Опціонально) зони, куди агенти не можуть заходити.

### 2\. Актори та їх поведінка 

Після аналізу карти треба описати акторів та їхню поведінку. Симуляція передбачає 3 типи агентів: **Студент**, **Продавець (Касир)** та **Стіл**. Кожен тип має свою специфічну поведінку:

1.  **Продавець:** Завжди стоїть на одному місці та лише обслуговує студентів. Один продавець одночасно може обслуговувати лише одного студента. Він має внутрішній стан, який визначає, чи зайнятий він на даний момент.
2.  **Стіл:** Також виступає як агент (а не патч), що спрощує навігацію та взаємодію. Стіл має обмежену місткість (capacity).
3.  **Студент:** Найбільш динамічний агент, який виконує послідовність дій:
      * Заходить у їдальню та стає у чергу до каси.
      * Коли настає його черга і касир вільний — починає обирати товар.
      * Обирання товару та обслуговування займає від 1 до 5 тактів системи (випадкова величина).
      * Після отримання їжі шукає вільний стіл, займає його на певний час, їсть, а потім покидає систему.

### 3\. Налаштування світу 

Після написання первинного Технічного завдання можемо переходити до створення мапи. Першим кроком змінимо розмірну сітку світу. Це дозволить нам зробити мапу більш детальною. Зробити це можна двома способами: через налаштування інтерфейсу або програмно. Оберемо **програмний варіант**, щоб налаштування зберігалися в коді.
У процедурі `setup` пропишемо наступний код:
`resize-world -20 20 -20 20` `set-patch-size 12`

### 4\. Агенти та їх параметри

Додамо агентів до симуляції за допомогою команди `breed`.

```netlogo
breed [students student]
breed [sellers seller]
breed [tables table]
```

Для кожного типу акторів додамо їхні внутрішні параметри.
Для **столу**:

```netlogo
tables-own [
  capacity      ; Максимальна кількість студентів за столом
  occupied-seats ; Поточна кількість зайнятих місць (опціонально, можна рахувати динамічно)
]
```

Для **касира**:

```netlogo
sellers-own [
  is-busy?      ; true/false - показує, чи обслуговує він наразі когось
]
```

Для **студента** потрібно задати найбільше параметрів для реалізації машини станів:

```netlogo
students-own [
  state          ; Поточний стан агента
  target-table   ; Посилання на конкретний стіл, до якого йде студент
  my-cashier     ; Посилання на касира, якого зайняв студент
  
  eating-timer   ; Час, необхідний на споживання їжі
  service-time   ; Час, необхідний на обслуговування на касі
  
  waiting-time   ; Лічильник часу в черзі (метрика)
  searching-time ; Лічильник часу пошуку місця (метрика)
]
```

Змінна `state` може приймати наступні значення: `"waiting"`, `"choosing"`, `"searching"`, `"eating"`, `"done"`. Залежно від стейта (стану) змінюється поведінка користувача та його колір (наприклад, у черзі — синій, їсть — зелений).

### 5\. Логіка пересування студентів

Логіка руху реалізується через машину станів (State Machine) у процедурі `go` -\> `move-student`. Основні принципи:

  * **У стані "waiting":** Студент рухається до найближчого касира. Реалізується фізика черги: агент робить крок вперед, лише якщо патч попереду вільний від інших студентів.
  * **У стані "searching":** Після отримання їжі студент обирає цільовий стіл (`target-table`), де кількість зайнятих місць менша за `capacity`. Рух відбувається цілеспрямовано до обраного столу.
  * **У стані "eating":** Студент знаходиться на координатах столу і не рухається, поки не вичерпається таймер `eating-timer`.
  * **У стані "done":** Студент рухається до точки виходу і зникає з симуляції (`die`).


### 6\. Дослідження моделі

Етап дослідження передбачає тестування імітаційної моделі та варіювання її вхідних параметрів для пошуку оптимальної конфігурації. Для інтерпретації часових характеристик зазначимо, що один такт (tick) модельного часу відповідає приблизно **20 секундам** реального часу.

Дослідження складається з 4 етапів: перші три передбачають зміну лише одного ключового параметра (ceteris paribus), а четвертий — комплексний пошук найкращого результату. Цільова метрика — визначити максимальну кількість користувачів, яку їдальня здатна ефективно обробити за **100 тактів**.

### 6.1. Визначення вузького місця в системі

**Мета:** Визначити, як зростання кількості студентів впливає на час обробки при мінімальних ресурсах.
**Початкові параметри:** 3 столи (максимальна ємність 12), 1 продавець.

| № Експерименту | Кількість столів | Кількість персоналу | Кількість студентів | Середній час очікування (такти) | Середній час пошуку (такти) | Кількість тактів (всього) |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **1** | 3 | 1 | 10 | 39.1 | 18.8 | 104 |
| **2** | 3 | 1 | 10 | 29.0 | 12.0 | 78 |
| **3** | 3 | 1 | 10 | 26.0 | 15.0 | 118 |
| **4** | 3 | 1 | 20 | 48.1 | 24.1 | 124 |
| **5** | 3 | 1 | 20 | 65.0 | 15.0 | 190 |
| **6** | 3 | 1 | 20 | 47.0 | 36.0 | 156 |

Кількість студентів
10    | ██████████ 100 тактів (сер.)
20    | ████████████████ 157 тактів (сер.)
      0        50       100      150      200
                  Загальний час (такти)


**Аналіз:** Як видно з таблиці, навіть при 10 студентах час обробки часто перевищує 100 тактів. При збільшенні навантаження до 20 студентів загальний час зростає до 150-190 тактів. Основна проблема полягає у значному часі очікування (Waiting Time), який сягає 65 тактів. Це свідчить про наявність черги, яку ми спробуємо усунути в наступному етапі.

### 6.2. Вплив кількості персоналу

**Мета:** Перевірити гіпотезу, що збільшення кількості касирів зменшить час очікування в черзі.
**Параметри:** Столи фіксовані (3 шт.), кількість студентів фіксована (20), кількість продавців змінюється від 2 до 8.

| № Експерименту | Кількість столів | Кількість персоналу | Кількість студентів | Середній час очікування (такти) | Середній час пошуку (такти) | Кількість тактів (всього) |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **1** | 3 | 2 | 20 | 45.0 | 15.1 | 129 |
| **2** | 3 | 2 | 20 | 41.0 | 12.0 | 112 |
| **3** | 3 | 2 | 20 | 49.0 | 9.0 | 142 |
| **4** | 3 | 4 | 20 | 44.0 | 12.0 | 135 |
| **5** | 3 | 4 | 20 | 38.0 | 17.0 | 104 |
| **6** | 3 | 4 | 20 | 51.0 | 19.0 | 123 |
| **7** | 3 | 6 | 20 | 45.0 | 11.0 | 132 |
| **8** | 3 | 6 | 20 | 42.0 | 13.1 | 120 |
| **9** | 3 | 6 | 20 | 37.8 | 10.8 | 110 |
| **10** | 3 | 8 | 20 | 41.0 | 12.0 | 119 |
| **11** | 3 | 8 | 20 | 38.0 | 28.0 | 133 |
| **12** | 3 | 8 | 20 | 43.0 | 20.0 | 117 |

Кількість касирів

2     | ███████████████████████ 45.0 тактів
4     | ██████████████████████  44.3 тактів
6     | █████████████████████   41.6 тактів
8     | ████████████████████    40.6 тактів
      0         10        20        30        40        50
                  Середній час очікування

**Аналіз:** Дані показують несподіваний результат: збільшення кількості касирів з 2 до 8 **не призвело до суттєвого зменшення часу очікування** (він коливається в межах 38-51 такт). Це вказує на те, що "вузьким місцем" є не швидкість обслуговування, а інший фактор (ймовірно, логістика переміщення або дефіцит столів).

### 6.3. Вплив кількості столів

**Мета:** Перевірити вплив дефіциту посадкових місць на загальний час перебування в системі.
**Параметри:** Персонал максимізовано (10 касирів), кількість студентів (20), кількість столів змінюється (5 та 10).

| № Експерименту | Кількість столів | Кількість персоналу | Кількість студентів | Середній час очікування (такти) | Середній час пошуку (такти) | Кількість тактів (всього) |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **1** | 5 | 10 | 20 | 45.0 | 9.4 | 61 |
| **2** | 5 | 10 | 20 | 42.0 | 24.0 | 125 |
| **3** | 5 | 10 | 20 | 44.8 | 13.0 | 118 |
| **4** | 10 | 10 | 20 | 41.0 | 3.5 | 111 |
| **5** | 10 | 10 | 20 | 43.0 | 12.0 | 119 |
| **6** | 10 | 10 | 20 | 47.0 | 11.5 | 116 |

Кількість столів

5     | ███████████████ 15.5 тактів (сер.)
10    | █████████ 9.0 тактів (сер.)
15    | ██████ 6.0 тактів
20    | ███████ 6.7 тактів
      0    5    10   15   20
            Середній час пошуку

**Аналіз:** Збільшення кількості столів до 10 дозволило дещо знизити середній час пошуку місця (до 3.5-12 тактів), однак час очікування в черзі залишився стабільно високим (\~43 такти). Загальна тривалість симуляції суттєво не зменшилася.

### 6.4. Пошук оптимальної конфігурації 

**Мета:** Знайти баланс ресурсів для обробки 20 студентів за \~100 тактів.
**Параметри:** Варіюємо кількість столів (15-20) та персоналу (4-10).

| № Експерименту | Кількість столів | Кількість персоналу | Кількість студентів | Середній час очікування (такти) | Середній час пошуку (такти) | Кількість тактів (всього) |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **1** | 15 | 4 | 20 | 36.0 | 6.0 | 104 |
| **2** | 15 | 4 | 20 | 48.0 | 7.0 | 126 |
| **3** | 15 | 4 | 20 | 43.0 | 5.0 | 127 |
| **4** | 15 | 8 | 20 | 40.0 | 4.5 | 105 |
| **5** | 15 | 8 | 20 | 37.0 | 4.3 | 100 |
| **6** | 15 | 8 | 20 | 44.1 | 10.0 | 139 |
| **7** | 20 | 10 | 20 | 41.0 | 9.0 | 101 |
| **8** | 20 | 10 | 20 | 44.0 | 7.0 | 115 |
| **9** | 20 | 10 | 20 | 41.0 | 4.0 | 107 |

### 7\. Висновки

На основі проведених експериментів можна зробити наступні висновки:

За результатами моделювання встановлено, що гранична пропускна здатність системи становить 20 відвідувачів, при якій повний цикл обслуговування завершується за прийнятний час (100–110 тактів). Експерименти виявили неефективність екстенсивного масштабування: збільшення штату касирів понад 4 одиниці не призводить до скорочення черг, оскільки час очікування стабілізується на рівні 40 тактів. Це підтверджує, що «вузьким місцем» системи є не швидкість сервісу, а логістика переміщення: одночасна поява групи агентів та значні відстані на мапі створюють фізичні затори, які блокують доступ студентів навіть до вільних кас.

Враховуючи, що основним фактором затримок є час на навігацію та колізії агентів, подальше додавання персоналу є економічно недоцільним. Для підвищення ефективності їдальні рекомендовано застосувати топологічну оптимізацію: зменшити загальний розмір мапи або перепланувати зонування так, щоб столи знаходилися ближче до зони видачі. Скорочення дистанцій між ключовими точками (вхід–каса–стіл) дозволить мінімізувати час перебування агентів у дорозі та усунути черги, викликані недоліками планування простору.
