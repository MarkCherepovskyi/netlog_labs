# Комп'ютерні системи імітаційного моделювання
## Лабораторна робота №2. Редагувння імітаційних моделей у середовищі NetLogo

s
# СПм-24-3 Череповський Марк Андрійович 
<br>

### 2.1 Мета роботи
Отримати уявлення про синтаксис та можливості мови мультиагентного імітаційного моделювання NetLogo.  
Навчитися вносити зміни до вихідного коду готових моделей з різних предметних областей, які пропонуються середовищем NetLogo.

<br>

Варіант 2 


Модель [Wolf Sheep Predation](https://www.netlogoweb.org/launch#http://www.netlogoweb.org/assets/modelslib/Sample%20Models/Biology/Wolf%20Sheep%20Predation.nlogo)
<br>

Хід роботи

Основні компоненти коду моделі


На самому початку файлу ми створюємо глобальні змінні та описуємо, які саме агенти використовуються у симуляції. У нашому випадку це дві породи черепашок: sheep та wolves. Також перевіряємо, у якому саме середовищі запускається симуляція: якщо це веб-версія NetLogo, то ми додатково обмежуємо максимальну кількість агентів, щоб модель не перевантажувала браузер і залишалась стабільною під час виконання. На десктопній версії це обмеження може бути вищим, оскільки там, як правило, більше ресурсів.

Наступним кроком за допомогою процедури setup ми створюємо карту (сітку патчів) та розміщуємо на ній агентів. У залежності від обраної версії симуляції визначається, як саме буде створюватися та поводитися трава. Якщо обрано модель типу sheep-wolves-grass, тоді кожен патч може бути або із травою, або без неї, а також має власний лічильник часу до відростання трави. Якщо ж обрана модель без трави, усі патчі одразу фарбуються в зелений колір, і питання росту трави не розглядається.

У головному циклі симуляції go ми поступово переміщуємо агентів і оновлюємо їхній стан. Кожен такт часу усі вівці та вовки виконують власні процедури руху, взаємодіють між собою та з навколишнім середовищем. Якщо на одній клітинці карти опиняються два або більше вовків, модель обробляє цей конфлікт так, що в результаті на патчі залишається лише один вовк. Така логіка імітує конкуренцію хижаків за територію. Якщо обрана симуляція типу sheep-wolves-grass, додатково кожен хід оновлюється стан трави: бурі патчі з часом знову стають зеленими, що формує більш реалістичний цикл «пасовище – випас – відростання».

Початкова версія моделі використовувала уніфікований рух для всіх агентів через спільну процедуру move: черепашка кожного типу випадковим чином поверталася праворуч і ліворуч на деякий кут і робила один крок уперед. Цей підхід створює просту випадкову прогулянку, але не дозволяє змоделювати більш складну поведінку, наприклад, цілеспрямоване переслідування або втечу. Саме тому у модифікованій версії моделі ця логіка поступово замінюється на більш складну та осмислену: ми вводимо окремі процедури руху для овець та для вовків, які враховують їхню роль у системі: вівці намагаються тікати від небезпеки, а вовки – шукати здобич.

Також кожного ходу в кожного агента симуляції є можливість розмножитися за допомогою функцій із префіксом reproduce. Під час розмноження енергія батьківського агента ділиться навпіл між ним та новим нащадком, що імітує витрати ресурсів на народження нового індивіда. Якщо запас енергії агента опускається нижче нуля, він помирає, що дозволяє моделі підтримувати баланс між народжуваністю та смертністю і не допускати безконтрольного зростання популяції.

### Внести зміни у логіку роботи моделі, згідно варіанту.
Згідно з варіантом завдання потрібно внести певні зміни у модель, а саме змінити логіку руху та взаємодії вовків і овець. Прибрати "зграйність" вовків - тепер перед початком свого ходу вовки повинні "оглядатися", перевіряючи оточення, та обирати напрямок руху виходячи з наявності вівець та відсутності інших вовків. Якщо немає іншої можливості – переміщається випадково. При знаходженні на одній ділянці поля двох вовків залишається лише один з них. Вівці переміщаються випадковим чином, але при виявленні вовка на одній із клітин поруч змінюють напрямок на протилежний.

Першим кроком для реалізації цієї поведінки ми замінюємо уніфікований рух об’єктів. Замість спільної процедури move:

```
ask sheep [
  move
  ...
]
ask wolves [
  move
  ...
]

to move  ; turtle procedure
  rt random 50
  lt random 50
  fd 1
end
```

ми вводимо окремі процедури для кожного типу агентів. Для вівці реалізуємо переміщення з урахуванням втечі:

```
to move-sheep  ;; sheep procedure
  ;; базовий випадковий рух
  rt random 50
  lt random 50

  ;; якщо поруч (на сусідніх патчах) є вовк — розвертаємось і тікаємо
  if any? wolves-on neighbors [
    rt 180
  ]

  fd 1
end
```

У цьому випадку вівця спочатку поводиться як у класичній моделі випадкового блукання, але, якщо на будь-якому із сусідніх патчів з’являється вовк, вона змінює напрямок на протилежний і робить крок, намагаючись збільшити відстань до хижака.

Для вовків реалізуємо окрему процедуру move-wolf, в якій вони вже не рухаються бездумно, а аналізують найближче оточення. Ми формуємо список зсувів до восьми сусідніх клітин і для кожного такого патча перевіряємо, чи є там вівці та чи присутні інші вовки. Патчі, на яких є вівці й немає інших вовків, потрапляють до множини пріоритетних цілей, а патчі без вовків – до множини запасних варіантів. Далі вовк обирає, куди рухатись, у порядку пріоритетів: спочатку до патчів із вівцями без вовків, потім – до патчів без вовків, а якщо варіантів немає – рухається випадково:

```netlogo
to move-wolf  ;; wolf procedure
  ;; список зсувів до сусідніх клітин (8 напрямків)
  let neighbor-offsets [[1 0] [-1 0] [0 1] [0 -1] [1 1] [1 -1] [-1 1] [-1 -1]]

  ;; тепер це agentset-и, а не списки
  let candidates-sheep no-patches
  let candidates-safe  no-patches

  foreach neighbor-offsets [ offset ->
    let x-offset first offset
    let y-offset last offset
    let p patch-at x-offset y-offset
    if p != nobody [
      ;; на патчі є вівці і немає інших вовків
      if any? [ sheep-here ] of p and not any? [ wolves-here ] of p [
        set candidates-sheep (patch-set candidates-sheep p)
      ]
      ;; патч без вовків — запасний варіант
      if not any? [ wolves-here ] of p [
        set candidates-safe (patch-set candidates-safe p)
      ]
    ]
  ]

  ifelse any? candidates-sheep [
    move-to one-of candidates-sheep
  ] [
    ifelse any? candidates-safe [
      move-to one-of candidates-safe
    ] [

      rt random 50
      lt random 50
      fd 1
    ]
  ]
end
```

Окремо змінюємо поведінку вовків, якщо вони стикаються в межах однієї клітинки. Для цього вводимо додаткову процедуру, яка запускається після руху всіх вовків. Вона проходиться по всіх патчах, на яких присутні два чи більше вовків, випадковим чином обирає одного «вижившого», а решта вовків на цьому патчі видаляються. Така логіка відображає конкуренцію хижаків за територію і ресурси та не дозволяє їм накопичуватись у одному місці, що робить модель більш реалістичною з точки зору просторової структури популяції.

```
to resolve-wolf-conflicts
  ask patches with [ count wolves-here > 1 ] [
    let survivor one-of wolves-here
    ask other wolves-here [ die ]
  ]
end
```


### Внесення змін за власним бажанням 

Після внесених змін модель стала більш реалістичною, але все одно не покриває всіх можливих сценаріїв взаємодії хижаків і жертв. Щоб поглибити поведінку вовків, додамо урахування радіусу, в якому вовк оцінює оточення. Для цього вводимо параметр wolf-vision-radius (за допомогою слайдера в інтерфейсі) і змінюємо логіку руху так, щоб вовк бачив не лише вісім сусідніх клітин, а всі патчі в заданому радіусі. Замість ручного переліку зсувів використовуємо конструкцію patches in-radius wolf-vision-radius, а потім шукаємо серед них патчі з вівцями без інших вовків, або хоча б просто без вовків, і рухаємося у напрямку найближчої придатної цілі:

```netlogo
to move-wolf
  let visible-patches patches in-radius wolf-vision-radius
  let candidates-sheep no-patches
  let candidates-safe  no-patches

  ask visible-patches [
    if any? sheep-here and not any? wolves-here [
      set candidates-sheep patch-set candidates-sheep self
    ]
    if not any? wolves-here [
      set candidates-safe patch-set candidates-safe self
    ]
  ]

  ifelse any? candidates-sheep [
    let target min-one-of candidates-sheep [ distance myself ]
    face target
    fd 1
  ] [
    ifelse any? candidates-safe [
      let target min-one-of candidates-safe [ distance myself ]
      face target
      fd 1
    ] [
      rt random 50
      lt random 50
      fd 1
    ]
  ]
end
```

Окрім просторових факторів можна врахувати й погодні або сезонні умови. Наприклад, додавши chooser season з варіантами "spring", "summer", "autumn", "winter", ми можемо змінювати виживаність вовків у залежності від пори року. У випадку з зимою вводимо додатковий ризик смерті від холоду: кожен хід взимку кожен вовк має 40% ймовірності загинути незалежно від рівня енергії. Це реалізується простою вставкою у головний цикл після основної логіки руху, харчування та розмноження вовків:

```netlogo
ask wolves [
  move-wolf
  set energy energy - 1
  eat-sheep
  death
  reproduce-wolves
]

if season = "winter" [
  	ask wolves [
      if energy < 50 [
      	 if random-float 100 < 5 [
          die   ;; 
        ] 
      ]
    ]
  ]
```

Такі розширення дозволяють моделі реагувати не лише на локальну конфігурацію сусідів, а й на глобальні умови середовища. Вовки починають поводитися по-різному залежно від радіуса огляду й часу року, а динаміка популяцій стає більш складною: взимку навіть чисельно сильна популяція хижаків може різко скоротитися через холод, а за великого радіусу огляду вовки швидше знаходять овець, що, своєю чергою, змушує овець частіше тікати та змінювати траєкторії руху. Це робить симуляцію ближчою до реальних екосистем, але водночас показує, що навіть з такими ускладненнями модель все ще є спрощенням і може бути доповнена новими механізмами у майбутньому.


### Обчислювальні експеременти

Розглянемо, як змінилася ситуація симуляції у порівнянні з класичною моделлю. З минулої роботи пам’ятаємо, що коли вовків більше, ніж овець, зазвичай саме вівці перемагають, оскільки вовки швидко вичерпують ресурси. Але якщо ввести певні обмеження у вигляді обмежених ресурсів, система демонструє більш збалансовану роботу, яка часто майже не залежить від початкової кількості агентів. Проведемо два дослідження, щоб переконатися, що система стала працювати стабільніше після додавання розумного руху, а також проаналізуємо вплив погодних умов. В обох дослідженнях змінюється лише початкова кількість овець, тоді як інші параметри залишаються незмінними.

| Початкова кількість овець | Фінальна кількість овець | Фінальна кількість вовків | Радіус огляду |
| ------------------------- | ------------------------ | ------------------------- | ------------- |
| 20                        | 497                      | 0                         | 2             |
| 20                        | 0                        | 0                         | 5             |
| 20                        | 0                        | 0                         | 10            |
| 40                        | 231                      | 0                         | 2             |
| 40                        | 0                        | 0                         | 5             |
| 40                        | 0                        | 0                         | 10            |
| 60                        | 0                        | 0                         | 2             |
| 60                        | 0                        | 0                         | 5             |
| 60                        | 780                      | 0                         | 10            |

З отриманих результатів видно, що система стає менш рівноважною зі збільшенням радіуса, у межах якого вовк може аналізувати шлях. Великий радіус огляду підсилює дисбаланс: вовки швидше знаходять овець, але так само швидко вичерпують ресурс і вимирають.

| Початкова кількість овець | Фінальна кількість овець | Фінальна кількість вовків | Радіус огляду |
| ------------------------- | ------------------------ | ------------------------- | ------------- |
| 20                        | 123                      | 0                         | 1             |
| 20                        | 412                      | 0                         | 2             |
| 20                        | 672                      | 0                         | 10            |
| 40                        | 257                      | 0                         | 1             |
| 40                        | 539                      | 0                         | 2             |
| 40                        | 783                      | 0                         | 10            |
| 60                        | 973                      | 0                         | 1             |
| 60                        | 321                      | 22                        | 2             |
| 60                        | 132                      | 0                         | 10            |

Після зміни пори року на холодну, коли вовк має ненульову ймовірність померти від холоду, кількість вовків, які залишилися живими до кінця симуляції, майже завжди дорівнює нулю. Навіть збільшення радіуса огляду не допомогло покращити ситуацію, оскільки додатковий фактор випадкової смертності перекриває перевагу від розумнішого пошуку здобичі.
